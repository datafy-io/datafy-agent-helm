# datafy-agent

![Version: 3.0.3](https://img.shields.io/badge/Version-3.0.3-informational?style=flat-square) ![AppVersion: 1.34.12_1.1.3_1.0.1](https://img.shields.io/badge/AppVersion-1.34.12_1.1.3_1.0.1-informational?style=flat-square)

**App Version:**

1.34.12_1.1.3_1.0.1

This guide explains how to add the Datafy Helm repo and install the `datafy-agent`.

---

## Features
- Dual mode: sensor / autoscaler
- CSI proxy support
- Configurable env, resources, tolerations, affinity
- Pluggable token secret
- Validations (CSI presence, mode logic)
- Autogenerated values documentation (helm-docs)

---

## Installation Guide
### 1. Add Repo
```bash
helm repo add datafyio https://helm.datafy.io/datafy-agent
helm repo update
```

### 2. Install
```bash
helm install datafy-agent --version 3.0.3 datafyio/datafy-agent \
--namespace datafy-agent --create-namespace \
--set agent.mode="sensor/autoscaler" \
--set agent.token=<your_token> \
--atomic
```

## Upgrade
```bash
helm repo update
helm upgrade --install datafy-agent --version 3.0.3 datafyio/datafy-agent -n <namespace> --reuse-values --atomic
```

Switch mode:
```bash
helm upgrade --install datafy-agent --version 3.0.3 datafyio/datafy-agent -n <namespace> --set agent.mode=autoscaler --atomic
```

Rollback:
```bash
helm rollback datafy-agent 1 -n <namespace>
```

### 5. Verify
```bash
kubectl get pods -n <namespace> -l app.kubernetes.io/instance=datafy-agent
```
---

## Uninstall
```bash
helm uninstall datafy-agent --namespace <namespace>
```
---

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| agent.affinity.nodeAffinity | object | `{}` |  |
| agent.dsoUrl | string | `"wss://dso.datafy.io"` |  |
| agent.externalTokenSecret.key | string | `nil` |  |
| agent.externalTokenSecret.name | string | `nil` |  |
| agent.image.pullPolicy | string | `"Always"` |  |
| agent.image.repository | string | `"public.ecr.aws/datafy-io/datafy-agent"` |  |
| agent.image.tag | string | `nil` |  |
| agent.mode | string | `"AutoScaler"` |  |
| agent.nodeSelector | object | `{}` |  |
| agent.securityContext.privileged | bool | `true` |  |
| agent.securityContext.runAsGroup | int | `1000` |  |
| agent.securityContext.runAsUser | int | `1000` |  |
| agent.serviceAccount.create | bool | `true` |  |
| agent.serviceAccount.name | string | `"datafy-agent-sa"` |  |
| agent.token | string | `nil` |  |
| agent.tolerations[0].operator | string | `"Exists"` |  |
| controller.affinity | string | `nil` |  |
| controller.image.pullPolicy | string | `"IfNotPresent"` |  |
| controller.image.repository | string | `"public.ecr.aws/datafy-io/datafy-controller"` |  |
| controller.image.tag | string | `nil` |  |
| controller.nodeSelector | object | `{}` |  |
| controller.replicas | int | `2` |  |
| controller.securityContext.runAsNonRoot | bool | `true` |  |
| controller.securityContext.runAsUser | int | `1001` |  |
| controller.serviceAccountName | string | `"datafy-controller-sa"` |  |
| controller.tolerations[0].operator | string | `"Exists"` |  |
| ebsCsiProxy.image.pullPolicy | string | `"IfNotPresent"` |  |
| ebsCsiProxy.image.repository | string | `"public.ecr.aws/datafy-io/ebs-csi-controller"` |  |
| ebsCsiProxy.image.tag | string | `nil` |  |
| ebsCsiProxy.livenessProbe | string | `nil` |  |
| ebsCsiProxy.readinessProbe.failureThreshold | int | `5` |  |
| ebsCsiProxy.readinessProbe.periodSeconds | int | `30` |  |
| ebsCsiProxy.readinessProbe.successThreshold | int | `1` |  |
| ebsCsiProxy.readinessProbe.timeoutSeconds | int | `10` |  |
| ebsCsiProxy.resources.limits.memory | string | `"256Mi"` |  |
| ebsCsiProxy.resources.requests.cpu | string | `"10m"` |  |
| ebsCsiProxy.resources.requests.memory | string | `"40Mi"` |  |
| extraAnnotations | object | `{}` |  |
| extraLabels | object | `{}` |  |
| imagePullSecrets | list | `[]` |  |

## Notes
Generated by helm-docs. Do not edit Parameters manually.
