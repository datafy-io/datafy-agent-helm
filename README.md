# datafy-agent

![Version: 2.0.0](https://img.shields.io/badge/Version-2.0.0-informational?style=flat-square) ![AppVersion: 1.31.8_0.3.1](https://img.shields.io/badge/AppVersion-1.31.8_0.3.1-informational?style=flat-square)

**App Version:**

1.31.8_0.3.1

This guide explains how to add the Datafy Helm repo and install the `datafy-agent`.

---

## Features
- Dual mode: sensor / autoscaler
- Optional bundled aws-ebs-csi-driver
- CSI proxy support
- Configurable env, resources, tolerations, affinity
- Pluggable token secret
- Validations (CSI presence, mode logic)
- Autogenerated values documentation (helm-docs)

---

## Dependencies
The chart can optionally install the AWS EBS CSI driver.
Set `awsEbsCsiDriver.enabled=true` to deploy it, or `false` to use an existing install.

## Requirements

| Repository | Name | Version |
|------------|------|---------|
| https://kubernetes-sigs.github.io/aws-ebs-csi-driver | aws-ebs-csi-driver | 2.45.1 |

## Installation Guide
### 1. Add Repo
```bash
helm repo add datafyio https://helm.datafy.io/datafy-agent
helm repo update
```

### 2. Install
```bash
helm install datafy-agent --version 2.0.0 datafyio/datafy-agent \
--namespace datafy-agent --create-namespace \
--set agent.mode="sensor/autoscaler" \
--set agent.token=<your_token> \
--atomic
```

## Upgrade
```bash
helm repo update
helm upgrade --install datafy-agent --version 2.0.0 datafyio/datafy-agent -n <namespace> --reuse-values --atomic
```

Switch mode:
```bash
helm upgrade --install datafy-agent --version 2.0.0 datafyio/datafy-agent -n <namespace> --set agent.mode=autoscaler --atomic
```

Rollback:
```bash
helm rollback datafy-agent 1 -n <namespace>
```

### 5. Verify
```bash
kubectl get pods -n <namespace> -l app.kubernetes.io/instance=datafy-agent
```
---

## Uninstall
```bash
helm uninstall datafy-agent --namespace <namespace>
```
---

## Values

| Key | Type | Default | Description |
|-----|------|---------|-------------|
| agent.affinity.nodeAffinity | object | `{}` |  |
| agent.dsoUrl | string | `"wss://dso.datafy.io"` |  |
| agent.env | object | `{}` |  |
| agent.externalTokenSecret.key | string | `nil` |  |
| agent.externalTokenSecret.name | string | `nil` |  |
| agent.image.imagePullSecrets | list | `[]` |  |
| agent.image.pullPolicy | string | `"Always"` |  |
| agent.image.repository | string | `"public.ecr.aws/datafy-io/datafy-agent"` |  |
| agent.image.tag | string | `nil` |  |
| agent.mode | string | `"AutoScaler"` |  |
| agent.nodeSelector | object | `{}` |  |
| agent.securityContext.privileged | bool | `true` |  |
| agent.securityContext.runAsGroup | int | `1000` |  |
| agent.securityContext.runAsUser | int | `1000` |  |
| agent.token | string | `nil` |  |
| agent.tolerations[0].operator | string | `"Exists"` |  |
| awsEbsCsiDriver.enabled | bool | `false` |  |
| ebsCsiProxy.enabled | bool | `true` |  |
| ebsCsiProxy.image.pullPolicy | string | `"IfNotPresent"` |  |
| ebsCsiProxy.image.repository | string | `"public.ecr.aws/datafy-io/ebs-csi-controller"` |  |
| ebsCsiProxy.image.tag | string | `nil` |  |
| ebsCsiProxy.namespace | string | `nil` |  |
| extraAnnotations | object | `{}` |  |
| extraLabels | object | `{}` |  |

## Notes
Generated by helm-docs. Do not edit Parameters manually.
