{{ template "chart.header" . }}
{{ template "chart.badgesSection" . }}
{{ template "chart.description" . }}

**App Version:**

{{ template "chart.appVersion" . }}


This guide explains how to add the Datafy Helm repo and install the `datafy-agent`.

---

## Features
- Dual mode: sensor / autoscaler
- Optional bundled aws-ebs-csi-driver
- CSI proxy support
- Configurable env, resources, tolerations, affinity
- Pluggable token secret
- Validations (CSI presence, mode logic)
- Autogenerated values documentation (helm-docs)

---

## Dependencies
The chart can optionally install the AWS EBS CSI driver.
Set `awsEbsCsiDriver.enabled=true` to deploy it, or `false` to use an existing install.

{{ template "chart.requirementsSection" . }}

## Installation Guide
### 1. Add Repo
```bash
helm repo add datafyio https://helm.datafy.io/datafy-agent
helm repo update
```

### 2. Install
```bash
helm install datafy-agent --version {{ template "chart.version" . }} datafyio/datafy-agent \
--namespace datafy-agent --create-namespace \
--set agent.mode="sensor/autoscaler" \
--set agent.token=<your_token> 
```

## Upgrade
```bash
helm repo update
helm upgrade --install datafy-agent --version {{ template "chart.version" . }} datafyio/datafy-agent -n <namespace> --reuse-values
```

Switch mode:
```bash
helm upgrade --install datafy-agent --version {{ template "chart.version" . }} datafyio/datafy-agent -n <namespace> --set agent.mode=autoscaler
```

Rollback:
```bash
helm rollback datafy-agent 1 -n <namespace>
```

### 5. Verify
```bash
kubectl get pods -n <namespace> -l app.kubernetes.io/instance=datafy-agent
```
---

## Uninstall
```bash
helm uninstall datafy-agent --namespace <namespace>
```
---

{{ template "chart.valuesSection" . }}

## Notes
Generated by helm-docs. Do not edit Parameters manually.
