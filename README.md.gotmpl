{{ template "chart.header" . }}
{{ template "chart.badgesSection" . }}
{{ template "chart.description" . }}

**App Version:**

{{ template "chart.appVersion" . }}

This guide explains how to add the Datafy Helm repo and install the `datafy-agent`.

---

## Features
- Dual mode: sensor / autoscaler
- Optional bundled aws-ebs-csi-driver
- CSI proxy support
- Configurable env, resources, tolerations, affinity
- Pluggable token secret
- Validations (CSI presence, mode logic)
- Autogenerated values documentation (helm-docs)

---

## Dependencies
The chart can optionally install the AWS EBS CSI driver.
Set `awsEbsCsiDriver.enabled=true` to deploy it, or `false` to use an existing install.

{{ template "chart.requirementsSection" . }}

---

## Quick Start (Sensor)
```bash
helm repo add datafyio https://helm.datafy.io/datafy-agent
helm repo update
helm upgrade --install datafy-agent datafyio/datafy-agent \
  --namespace datafy --create-namespace \
  --set agent.mode="sensor" \
  --set agent.token=$DATAFY_TOKEN \
```

## Quick Start (Autoscaler + Existing CSI)
```bash
helm repo add datafyio https://helm.datafy.io/datafy-agent
helm repo update
helm upgrade --install datafy-agent datafyio/datafy-agent \
  --namespace datafy --create-namespace \
  --set agent.mode="autoscaler" \
  --set agent.token=$DATAFY_TOKEN \
```
---

## Installation Guide
### 1. Add Repo
```bash
helm repo add datafyio https://helm.datafy.io/datafy-agent
helm repo update
```

### 2. Install
```bash
helm upgrade --install datafy-agent datafyio/datafy-agent --namespace <namespace> --create-namespace \
  --set agent.mode="sensor/autoscaler" \
  --set agent.token=<your_token> \
  
```
Override subchart values:
```yaml
--set agent.image.tag=<image_tag>
```

### 5. Verify
```bash
kubectl get pods -n <namespace> -l app.kubernetes.io/instance=datafy-agent
```

---

## Upgrade
```bash
helm repo update
helm upgrade --install datafy-agent datafyio/datafy-agent -n <namespace> --set agent.image.tag=<image_tag> --reuse-values 
```
Switch mode:
```bash
helm upgrade --install datafy-agent datafyio/datafy-agent -n <namespace> --set agent.mode=autoscaler 
```
Rollback:
```bash
helm rollback datafy-agent 1 -n <namespace> 
```

---

## Uninstall
```bash
helm uninstall datafy-agent --namespace <namespace>
```

---

## Development
```bash
helm lint .
helm-docs
```
---

## Parameters
{{ template "chart.valuesSection" . }}

## Notes
Generated by helm-docs. Do not edit Parameters manually.

---
_This README is rendered from README.md.gotmpl via helm-docs._
